language: node_js
node_js:
  - node
cache:
  directories:
    - node_modules


# safelist
branches:
  only:
  - develop
  # - master

stages:
  - name: lint
    if: type = pull_request
  - name: test
    env:
    - TEST_SUITE=unit
    - TEST_SUITE=integration
    - TEST_SUITE=acceptance
    if: type = pull_request
  - name: deploy
    if: type != pull_request
  - name: e2e
    if: type != pull_request



jobs:
  include:
    - stage: lint
      script: echo performing code analysis
    - stage: test
      script: npm run test:$TEST_SUITE
    - stage: deploy
      script: echo deploying to aws develop
    - stage: e2e
      script: echo running live suitable e2e tests in aws develop
    # - stage: deploy to production
    #   if: branch = master AND type != pull_request
    #   script: echo deploying to aws production
    # - stage: e2e tests in production
    #   if: branch = master AND type != pull_request
    #   script: echo running live suitable e2e tests

# notifications:
#   slack: '<account>:<token>#team-backend'
#     on_success: change
#     on_failure: change
#     on_pull_requests: false